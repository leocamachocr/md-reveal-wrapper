<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Presentación Reveal.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Reveal.js Core -->
    <link rel="stylesheet" href="{{ reveal_cdn }}/{{ reveal_version }}/reveal.min.css">
    <link rel="stylesheet" href="{{ reveal_cdn }}/{{ reveal_version }}/theme/{{ theme }}.min.css" id="theme">

    <!-- Highlight.js CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/{{ highlight_theme }}.min.css">

    <!-- Reveal.js Scripts -->
    <script src="{{ reveal_cdn }}/{{ reveal_version }}/reveal.min.js"></script>
    <script src="{{ reveal_cdn }}/{{ reveal_version }}/plugin/highlight/highlight.js"></script>
    <script src="{{ reveal_cdn }}/{{ reveal_version }}/plugin/math/math.min.js"></script>

    <style>
        /* Estilos base */
        .reveal section { font-size: {{ font_base }}; text-align: left; }
        .reveal section h1 { font-size: {{ font_h1 }}; }
        .reveal section h2 { font-size: {{ font_h2 }}; }
        .reveal section h3 { font-size: {{ font_h3 }}; }
        .reveal section h4 { font-size: {{ font_h4 }}; }
        .reveal section h5 { font-size: {{ font_h5 }}; }
        .reveal section h6 { font-size: {{ font_h6 }}; }
        .reveal p       { font-size: {{ font_p }}; }
        .reveal li      { font-size: {{ font_li }}; }

        /* Listas anidadas */
        .reveal section ul { padding-left: 1.5em !important; }
        .reveal section ul ul { padding-left: 2em !important; }
        .reveal section ul ul ul { padding-left: 2.5em !important; }

        /* Imágenes */
        .reveal section img {
            max-width: 40% !important;
            max-height: 40% !important;
            object-fit: contain;
            display: block !important;
            margin: 0 auto !important;
            cursor: zoom-in;
        }

        /* Overlay de lightbox */
        .image-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .image-overlay img {
            width: 100%;
            height: auto;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        /* Tablas */
        .reveal table {
            border-collapse: collapse;
            margin: 20px auto;
            width: 80%;
            font-size: 0.9em;
        }
        .reveal th, .reveal td {
            border: 1px solid #ccc;
            padding: 8px 12px;
            text-align: left;
        }
        .reveal th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        /* Breadcrumb */
        .reveal .header-trail {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            font-size: 0.4em;
            font-family: inherit !important;
            font-weight: inherit !important;
            line-height: 1.2;
            color: #333;
            background: rgba(255, 255, 255, 0.95);
            padding: 6px 12px;
            border-radius: 0 0 4px 0;
            z-index: 9999;
            max-width: 60%;
            white-space: normal;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .reveal .header-trail span { margin-right: 6px; }
        .reveal .header-trail span::after { content: "›"; margin-left: 6px; color: #aaa; }
        .reveal .header-trail span:last-child::after { content: ""; }

        .reveal blockquote {
            border-left: 6px solid #ccc;
            background: rgba(0, 0, 0, 0.05);
            padding: 12px 20px;
            margin: 20px auto;
            border-radius: 6px;
            max-width: 80%;
            font-size: 1em;
        }

        .reveal blockquote.info {
            border-left-color: #2a76dd;
            background: rgba(42, 118, 221, 0.1);
            color: #1a4f99;
        }

        .reveal blockquote.warning {
            border-left-color: #e67e22;
            background: rgba(230, 126, 34, 0.1);
            color: #b35400;
        }

        .reveal blockquote.tip {
            border-left-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            color: #1e8449;
        }


    </style>
</head>
<body>
<div class="reveal">
    {% if show_header_trail == "true" %}
    <div id="header-trail" class="header-trail"></div>
    {% endif %}
    <div class="slides">
        {{ slides | safe }}
    </div>
</div>

<script>
    Reveal.initialize({
        controls: {{ enable_controls | lower }},
        progress: {{ enable_progress | lower }},
        history: {{ enable_history | lower }},
        center: {{ align_center | lower }},
        transition: '{{ transition }}',
        width: {{ width }},
        height: {{ height }},
        margin: {{ margin }},
        minScale: {{ min_scale }},
        maxScale: {{ max_scale }},
        plugins: [ RevealMath.MathJax3, RevealHighlight ]
    });

    // Inicializar lightbox para imágenes con data-preview-image
    Reveal.on('ready', () => {
        document.querySelectorAll('img[data-preview-image]').forEach(img => {
            img.addEventListener('click', () => {
                const overlay = document.createElement('div');
                overlay.classList.add('image-overlay');

                const fullImage = document.createElement('img');
                fullImage.src = img.src;
                fullImage.style.width = '100%';
                fullImage.style.height = 'auto';

                overlay.appendChild(fullImage);
                overlay.addEventListener('click', () => overlay.remove());

                document.body.appendChild(overlay);
            });
        });

        // Forzar highlight.js
        if (window.hljs) {
            document.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
        }
    });

    // Breadcrumb dinámico
    const breadcrumb = document.getElementById("header-trail");
    Reveal.on('slidechanged', event => {
        if (breadcrumb) {
            breadcrumb.textContent = event.currentSlide.getAttribute("data-breadcrumb") || "";
        }
    });
</script>
</body>
</html>
